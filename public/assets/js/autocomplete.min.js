!function(e){function t(){this.customPlaceholderText=!1,this.wrapperClass="autocomplete-dropdown",this.inputClass=!1,this.allowAdditions=!1,this.noResultsText="No results found",this.onChange=null,this.onSelect=null}t.prototype={constructor:t,instances:{},init:function(t,s){var n=this;e.extend(n,s),n.isTouch="ontouchend"in document,n.$select=e(t),dataSettings=n.$select.data()||{},isMultiple=!1,n.id=t.id,n.name=t.name,n.options=[],n.$options=n.$select.find("option"),n.selected=[],n.$select.is(":disabled")&&(n.disabled=!0),n.$options.length&&(n.$options.each(function(t){var s=e(this);s.hasClass("label")&&0===t?(n.hasLabel=!0,n.label=s.text(),s.attr("value","")):n.options.push({domNode:s[0],title:s.text(),value:s.val(),selected:s.is(":selected")}),s.is(":selected")&&!s.hasClass("label")&&(n.selected={index:t,value:s.val(),title:s.text()},n.selected.push(selectedData),n.focusIndex=t)}),n.render())},render:function(){var t=this,s=t.isTouch&&t.nativeTouch?" touch":"",n=t.disabled?" disabled":"",o=t.readonly?" readonly":"",a=t.customPlaceholderText?t.customPlaceholderText:t.hasLabel?t.label:"",i=t.inputClass?t.inputClass:"",l=isMultiple?" multi-select":"",c=[];t.$container=t.$select.wrap('<div class="'+t.wrapperClass+n+s+o+l+'"><div class="old" /></div>').parent().parent(),t.$searchbox=e('<input type="text" class="'+i+'" placeholder="'+a+'" '+o+" />").appendTo(t.$container),t.$searchResults=e('<div class="results"><ul /></div>').appendTo(t.$container),t.$list=t.$searchResults.find("ul"),t.selected.length>0&&(t.multiSelect?(e.each(t.selected,function(e,t){c.push(" "+t.title)}),t.readonly?t.$searchbox.val(c):(e.each(t.selected,function(e,s){t.$searchbox.parent().append('<span class="option-tag">'+s.title+' <span class="remove-tag" data-option-value="'+s.value+'"></span></span>')}),t.tagClick())):t.$searchbox.val(t.selected[0].title)),t.bindHandlers()},getMaxHeight:function(){var e=this;e.maxHeight=0;for(var t=0;t<e.$items.length;t++){var s=e.$items.eq(t);if(e.maxHeight+=s.outerHeight(),e.cutOff===t+1)break}},bindTouchHandlers:function(){var t=this;t.$container.on("click.autocompleteDropdown",function(){t.$select.focus()}),t.$select.on({change:function(){var s=e(this).find("option:selected"),n=s.text(),o=s.val();t.$searchbox.val(n),"function"==typeof t.onSelect&&t.onSelect.call(t.$select[0],{title:n,value:o})},focus:function(){t.$container.addClass("focus")},blur:function(){t.$container.removeClass("focus")}})},bindHandlers:function(){var e=this;e.$searchbox.on({"focus.autocompleteDropdown":function(){e.$container.addClass("focus"),e.inFocus=!0},"blur.autocompleteDropdown":function(){e.$container.removeClass("focus"),e.inFocus=!1},"keyup.autocompleteDropdown":function(){e.query=e.$searchbox.val().toUpperCase(),0!==e.query.length?e.search():e.close()}})},unbindHandlers:function(){this.$container.add(this.$select).add(this.$searchbox).off(".autocompleteDropdown")},tagClick:function(){var t=this,s=t.$searchbox.siblings(".option-tag").children(".remove-tag"),n=t.$select.val();s.on({click:function(){var s=e(this).data("option-value").toString();n=e.grep(n,function(e){return e!=s}),t.$select.val(n),e(this).parent().remove()}})},tagClick:function(){var t=this,s=t.$searchbox.siblings(".option-tag").children(".remove-tag"),n=t.$select.val();s.on({click:function(){var s=e(this).data("option-value").toString(),o=t.$select.children('option[value="'+s+'"]');n=e.grep(n,function(e){return e!=s}),t.$select.val(n),o.prop("selected",!1),e(this).parent().remove()}})},open:function(){this.$select.focus(),this.$container.addClass("open"),this.$searchResults.css("height",this.maxHeight+"px")},close:function(){e(this.$searchResults.find("ul")).html(""),this.$container.removeClass("open")},closeAll:function(){var e=Object.getPrototypeOf(this).instances;for(var t in e)e[t].close()},search:function(){var t=this,s=RegExp(t.query.replace(/[^\w\s]/gi,""),"i");t.search_results=[];for(var n=0;n<t.options.length;n++){var o,a=(o=n,t.options[o].title.toUpperCase());a.match(s)&&t.search_results.push(t.options[n])}(t.resultsNumber=t.search_results.length,e(t.$searchResults.find("ul")).html(""),t.resultsNumber>0)?e.each(t.search_results,function(){e('<li data-value="'+this.value+'">'+this.title+"</li>").appendTo(t.$searchResults.find("ul"))}):(!1===t.allowAdditions||!1===dataSettings.allowadditions)&&e("<li>"+(t.noResultsText||dataSettings.noresultstext)+"</li>").appendTo(t.$searchResults.find("ul")),t.$results=t.$list.find("li"),t.$results.on({click:function(){var s=e(this),n=s.data("value"),o=s.text(),i=t.$searchbox.val();if(""===n||void 0===n?(e('<option value="'+i+'" selected></option>').appendTo(t.$select),t.$searchbox.val(i)):(null!=t.$select.val()&&isMultiple,t.$select.val(n),t.$searchbox.val(o)),isMultiple){var l=null!=t.$select.val()?t.$select.val():[],c=""===n||void 0===n?i:o;t.$searchbox.val(""),t.$searchbox.parent().append('<span class="option-tag">'+c+' <span class="remove-tag" data-option-value="'+c+'"></span></span>'),void 0!=n&&l.push(n.toString()),e.each(l,function(e,s){t.$select.children('option[value="'+s+'"]').prop("selected",!0)}),t.tagClick()}"function"==typeof t.onChange&&t.onChange.call(t.$select[0],{title:a,value:n}),t.close()}}),t.open()},notInViewport:function(e){var t={min:e,max:e+(window.innerHeight||document.documentElement.clientHeight)},s=this.$searchResults.offset().top+this.maxHeight;return s>=t.min&&s<=t.max?0:s-t.max+5},destroy:function(){this.unbindHandlers(),this.$select.unwrap().siblings().remove(),this.$select.unwrap(),delete Object.getPrototypeOf(this).instances[this.$select[0].id]}};var s=function(e,s){e.id=e.id?e.id:"AutocompleteDropdown"+n();var o=new t;o.instances[e.id]||(o.instances[e.id]=o,o.init(e,s))},n=function(){return("00000"+(16777216*Math.random()<0).toString(16)).substr(-6).toUpperCase()};e.fn.autocompleteDropdown=function(){var e,n=arguments,o=[];return(e=this.each(function(){if(n&&"string"==typeof n[0]){var e=t.prototype.instances[this.id][n[0]](n[1],n[2]);e&&o.push(e)}else s(this,n[0])}),o.length)?o.length>1?o:o[0]:e},e(function(){"function"!=typeof Object.getPrototypeOf&&("object"==typeof"test".prototype?Object.getPrototypeOf=function(e){return e.prototype}:Object.getPrototypeOf=function(e){return e.constructor.prototype}),e("select.autocomplete").each(function(){var t=e(this).attr("data-settings");s(this,t?e.parseJSON(t):{})})})}(jQuery);
